def project = 'silent-oasis-249511'
def  THE_NAME = 'test44'

pipeline {
  agent any
  stages {
    stage('Build') {
      steps {
        withCredentials([sshUserPrivateKey(credentialsId: "github-deploy-key", keyFileVariable: 'keyfile')])  {
          sh """
                export GIT_SSH_COMMAND="ssh -i $keyfile -o IdentitiesOnly=yes"
          		git checkout -b test1123
                git push -u origin test1123
                """
        }
      }
    }
    stage('Create Job') {
      steps {
        jobDsl scriptText:
        """ 
        pipelineJob("${THE_NAME}") {
            definition {
                cpsScm {
                scm {
                    git {
                    remote {
                        url('https://github.com/yuvalo/spring-petclinic')
                    }
                    branch('*/master')
                    }
                }
                lightweight()
                }
            }
        }
        """
      }
    }
  }
} 
